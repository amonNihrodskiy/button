<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–í–µ—Å–Ω–∞</title>

  <style>
* {
  user-select: none;
  -webkit-tap-highlight-color: transparent;
  box-sizing: border-box;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

body {
  margin: 0;
  height: 100vh;
  background:
    radial-gradient(circle at top, rgba(255, 240, 248, 0.9), rgba(255, 255, 255, 0.0)),
    linear-gradient(180deg, #bfe9ff 0%, #ffe6f3 45%, #fff7d6 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  color: #2b1b2a;
  overflow: hidden;
}

.petal {
  position: fixed;
  top: -60px;
  font-size: 38px;
  animation: fall linear infinite;
  cursor: pointer;
  filter: drop-shadow(0 8px 14px rgba(0,0,0,0.10));
  z-index: 1;
}
@keyframes fall { to { transform: translateY(112vh) rotate(420deg); } }

.particle {
  position: fixed;
  font-size: 14px;
  pointer-events: none;
  animation: explode 0.9s ease-out forwards;
  z-index: 2;
}
@keyframes explode {
  to { transform: translate(var(--x), var(--y)) scale(0); opacity: 0; }
}

.score {
  position: fixed;
  top: 18px;
  left: 18px;
  padding: 10px 14px;
  border-radius: 14px;
  background: rgba(255,255,255,0.6);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.7);
  box-shadow: 0 8px 20px rgba(0,0,0,0.05);
  font-weight: 800;
  z-index: 5;
}

.container {
  text-align: center;
  padding: 20px;
  z-index: 3;
}

.static-text {
  margin-bottom: 15px;
  font-size: 28px;
  font-weight: 900;
  text-shadow: 0 0 20px rgba(255, 90, 160, 0.3);
}

.sub {
  font-size: 16px;
  color: rgba(43, 27, 42, 0.7);
  margin-bottom: 25px;
}

.text {
  margin-top: 20px;
  font-size: 22px;
  min-height: 1.6em;
  opacity: 0;
  filter: blur(12px);
  transform: scale(0.7);
  transition: 0.25s ease;
}

.text.show {
  opacity: 1;
  filter: blur(0);
  transform: scale(1);
}

button {
  padding: 16px 36px;
  font-size: 18px;
  border-radius: 50px;
  border: none;
  cursor: pointer;
  background: linear-gradient(135deg, #ff5aa8, #ffb84d);
  color: white;
  box-shadow: 0 10px 20px rgba(255, 90, 160, 0.3);
  transition: 0.2s;
}
button:active { transform: scale(0.95); }

#textBurst {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 10;
}
  </style>
</head>

<body>
  <canvas id="textBurst"></canvas>

  <div class="score" id="scoreBox">
    üå∏ —É—Ä–æ–≤–µ–Ω—å –≤–µ—Å–µ–Ω–Ω–µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è: <span id="scoreVal">0</span> / <span id="goal">457</span>
  </div>

  <div class="container" id="ui">
    <div class="static-text">üå∑ –° –ø–µ—Ä–≤—ã–º –¥–Ω—ë–º –≤–µ—Å–Ω—ã, –º–æ—è –º–∞–ª–µ–Ω—å–∫–∞—è üå∑</div>
    <div class="sub">–ù–∞–∂–∏–º–∞–π –Ω–∞ –ª–µ–ø–µ—Å—Ç–∫–∏, —á—Ç–æ–±—ã –Ω–∞–∫–æ–ø–∏—Ç—å –≤–µ—Å–µ–Ω–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</div>
    <button id="btn">–õ—é–±–ª—é —Ç–µ–±—è ‚ú®</button>
    <div id="text" class="text"></div>
  </div>

<script>
const TARGET_SCORE = 457;
function getMessageLines() {
  return window.innerWidth < 700 ? ["–Ø", "–¢–ï–ë–Ø", "–õ–Æ–ë–õ–Æ"] : ["–Ø –¢–ï–ë–Ø –õ–Æ–ë–õ–Æ"];
}

const TEXT_EMOJI = ['üå∏','üå∑','üå∫','üíÆ','üåº','‚ú®']; 


const petals = ['üå∏','üå∑','üå∫','üíÆ','üåº','‚ú®','üíó','üçÄ','üíñ']; 

let score = 0;
function addScore(amount) {
  score += amount;
  scoreVal.textContent = score;
  if (score >= TARGET_SCORE) {
    score = TARGET_SCORE;
    scoreVal.textContent = score;
    startFinal();
  }
}

const scoreVal = document.getElementById('scoreVal');
const text = document.getElementById('text');
const btn = document.getElementById('btn');
const ui = document.getElementById('ui');
const scoreBox = document.getElementById('scoreBox');
const canvas = document.getElementById('textBurst');
const ctx = canvas.getContext('2d', { alpha: true });

const phrases = [
  "–¢—ã –º–æ—ë —Å–∞–º–æ–µ —Ç—ë–ø–ª–æ–µ –≤–µ—Å–µ–Ω–Ω–µ–µ —Å–æ–ª–Ω—Ü–µ ‚òÄÔ∏è", "–ü—É—Å—Ç—å —ç—Ç–∞ –≤–µ—Å–Ω–∞ –ø—Ä–∏–Ω–µ—Å—ë—Ç —Ç–µ–±–µ –º–æ—Ä–µ —É–ª—ã–±–æ–∫ üå∏",
  "–° —Ç–æ–±–æ–π –∫–∞–∂–¥—ã–π –¥–µ–Ω—å —Ä–∞—Å—Ü–≤–µ—Ç–∞–µ—Ç –ø–æ-–Ω–æ–≤–æ–º—É üåº", "–¢—ã –ø—Ä–µ–∫—Ä–∞—Å–Ω–µ–µ –ª—é–±–æ–≥–æ –ø–µ—Ä–≤–æ—Ü–≤–µ—Ç–∞ ‚ú®",
  "–•–æ—á—É –æ–±–Ω–∏–º–∞—Ç—å —Ç–µ–±—è —ç—Ç–æ–π –≤–µ—Å–Ω–æ–π –µ—â—ë —á–∞—â–µ üíõ", "–° —Ç–æ–±–æ–π –¥–∞–∂–µ –º–∞—Ä—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∏—é–Ω–µ–º üå∑",
  "–¢—ã —Ä–∞—Å—Ü–≤–µ—Ç–∞–µ—à—å –≤ –º–æ—ë–º —Å–µ—Ä–¥—Ü–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å üå∫", "–†—è–¥–æ–º —Å —Ç–æ–±–æ–π –≤—Å—ë —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–≤–µ—Ç–ª–µ–µ üí´",
  "–¢—ã –º–æ—è —Å–∏–ª—å–Ω–µ–π—à–∞—è –≤–µ—Å–µ–Ω–Ω—è—è –º–∞–≥–∏—è ‚ú®", "–° —Ç–æ–±–æ–π –º–∏—Ä –ø–∞—Ö–Ω–µ—Ç —Ü–≤–µ—Ç–∞–º–∏ üå∏",
  "–¢—ã –¥–µ–ª–∞–µ—à—å –º–æ—é –≤–µ—Å–Ω—É –Ω–∞—Å—Ç–æ—è—â–µ–π üåº", "–¢–≤–æ—è —É–ª—ã–±–∫–∞ —è—Ä—á–µ –ª—é–±–æ–≥–æ —Ä–∞—Å—Å–≤–µ—Ç–∞ üåÖ",
  "–° —Ç–æ–±–æ–π –¥–∞–∂–µ –≤–µ—Ç–µ—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ª–∞—Å–∫–æ–≤—ã–º üçÉ", "–¢—ã –º–æ—ë —Å–∞–º–æ–µ –∫—Ä–∞—Å–∏–≤–æ–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ üåû",
  "–•–æ—á—É –¥–µ—Ä–∂–∞—Ç—å —Ç–≤–æ—é —Ä—É–∫—É –ø–æ–¥ –ø–µ—Ä–≤—ã–º —Ç—ë–ø–ª—ã–º —Å–æ–ª–Ω—Ü–µ–º üíõ", "–¢—ã –Ω–µ–∂–Ω–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –≤—Å–µ–≥–¥–∞ —Ä—è–¥–æ–º üå∑",
  "–° —Ç–æ–±–æ–π —Ö–æ—á–µ—Ç—Å—è —Å–º–µ—è—Ç—å—Å—è –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã üå∏", "–¢—ã –º–æ–π —Å–∞–º—ã–π –ª—é–±–∏–º—ã–π —Ü–≤–µ—Ç–æ–∫ üå∫",
  "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å —Å —Ç–æ–±–æ–π ‚Äî –∫–∞–∫ –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –≤–µ—Å–Ω—ã üåº", "–¢—ã –Ω–∞–ø–æ–ª–Ω—è–µ—à—å –º–µ–Ω—è —Å–≤–µ—Ç–æ–º ‚ú®",
  "–° —Ç–æ–±–æ–π –¥–∞–∂–µ –¥–æ–∂–¥—å –∑–≤—É—á–∏—Ç —Ä–æ–º–∞–Ω—Ç–∏—á–Ω–æ ‚òî", "–¢—ã –º–æ–π —Å–∞–º—ã–π —É—é—Ç–Ω—ã–π –º–∞—Ä—Ç üíï",
  "–†—è–¥–æ–º —Å —Ç–æ–±–æ–π —Å–µ—Ä–¥—Ü–µ —Ü–≤–µ—Ç—ë—Ç üå∏", "–¢—ã –º–æ—ë –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –∏ —Ç–µ–ø–ª–æ üí´",
  "–° —Ç–æ–±–æ–π –≤—Å—ë –≤–æ–∫—Ä—É–≥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º—è–≥—á–µ üå∑", "–¢—ã –º–æ—è —Å–∞–º–∞—è –∫—Ä–∞—Å–∏–≤–∞—è —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å üíñ",
  "–•–æ—á—É –¥–µ–ª–∏—Ç—å —Å —Ç–æ–±–æ–π –∫–∞–∂–¥—ã–π –∑–∞–∫–∞—Ç üåÖ", "–¢—ã –≤–µ—Å–Ω–∞, –∫–æ—Ç–æ—Ä–∞—è –∂–∏–≤—ë—Ç –≤–æ –º–Ω–µ üåº",
  "–° —Ç–æ–±–æ–π —Ö–æ—á–µ—Ç—Å—è —Å—Ç—Ä–æ–∏—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –∑–∞–≤—Ç—Ä–∞ ‚ú®", "–¢—ã –º–æ—ë —Å–∞–º–æ–µ –Ω–µ–∂–Ω–æ–µ —á—É–≤—Å—Ç–≤–æ üíõ",
  "–° —Ç–æ–±–æ–π –º–∏—Ä –∫–∞–∂–µ—Ç—Å—è –¥–æ–±—Ä–µ–µ üå∏", "–¢—ã –ø—Ä–∏—á–∏–Ω–∞ –º–æ–∏—Ö —Å—á–∞—Å—Ç–ª–∏–≤—ã—Ö –º—ã—Å–ª–µ–π üå∑",
  "–° —Ç–æ–±–æ–π –∫–∞–∂–¥—ã–π –≤–µ—á–µ—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—Å–æ–±–µ–Ω–Ω—ã–º üåô", "–¢—ã –º–æ—ë —Ç–∏—Ö–æ–µ —Å—á–∞—Å—Ç—å–µ üíï",
  "–†—è–¥–æ–º —Å —Ç–æ–±–æ–π —è —É–ª—ã–±–∞—é—Å—å —á–∞—â–µ üåº", "–¢—ã —Å–∞–º–æ–µ –∫—Ä–∞—Å–∏–≤–æ–µ, —á—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å —Å–æ –º–Ω–æ–π üå∏",
  "–° —Ç–æ–±–æ–π —Ö–æ—á–µ—Ç—Å—è –≤–µ—Ä–∏—Ç—å –≤ —á—É–¥–µ—Å–∞ ‚ú®", "–¢—ã –º–æ–π –ª—é–±–∏–º—ã–π —á–µ–ª–æ–≤–µ–∫ –≤ —ç—Ç–æ–º –º–∏—Ä–µ üíñ",
  "–° —Ç–æ–±–æ–π –¥–∞–∂–µ –æ–±—ã—á–Ω—ã–π –¥–µ–Ω—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–º üå∑", "–¢—ã –º–æ—ë —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –∏ –º–æ–π –æ–≥–æ–Ω—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ üî•",
  "–° —Ç–æ–±–æ–π —Å–µ—Ä–¥—Ü–µ –±—å—ë—Ç—Å—è –º—è–≥—á–µ üíõ", "–¢—ã –º–æ—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –≤–µ—Å–Ω–∞ üå∏",
  "–†—è–¥–æ–º —Å —Ç–æ–±–æ–π —Ö–æ—á–µ—Ç—Å—è –±—ã—Ç—å –ª—É—á—à–µ üåº", "–¢—ã –º–æ—è —Å–∞–º–∞—è —Ç—ë–ø–ª–∞—è –º—ã—Å–ª—å üå∑",
  "–° —Ç–æ–±–æ–π –≤—Å—ë –æ–±—Ä–µ—Ç–∞–µ—Ç —Å–º—ã—Å–ª ‚ú®", "–¢—ã –º–æ–π –ª—é–±–∏–º—ã–π —Ä–∞—Å—Å–≤–µ—Ç üí´",
  "–° —Ç–æ–±–æ–π —Ö–æ—á–µ—Ç—Å—è –æ–±–Ω–∏–º–∞—Ç—å –≤–µ—Å—å –º–∏—Ä üíï"
];

btn.onclick = () => {
  addScore(2);
  text.classList.remove('show');
  setTimeout(() => {
    text.textContent = phrases[Math.floor(Math.random() * phrases.length)];
    text.classList.add('show');
  }, 150);
};

function createPetal() {
  const p = document.createElement('div');
  p.className = 'petal';
  p.textContent = petals[Math.floor(Math.random() * petals.length)];
  p.style.left = (Math.random() * 90 + 5) + 'vw';
  p.style.animationDuration = (5 + Math.random() * 5) + 's';
  p.onclick = (e) => { explode(e.clientX, e.clientY); addScore(1); p.remove(); };
  document.body.appendChild(p);
  setTimeout(() => p.remove(), 8000);
}
let petalTimer = setInterval(createPetal, 600);

function explode(x, y) {
  for (let i = 0; i < 8; i++) {
    const part = document.createElement('div');
    part.className = 'particle';
    part.textContent = TEXT_EMOJI[Math.floor(Math.random() * TEXT_EMOJI.length)];
    part.style.left = x + 'px'; part.style.top = y + 'px';
    part.style.setProperty('--x', (Math.random() * 100 - 50) + 'px');
    part.style.setProperty('--y', (Math.random() * 100 - 50) + 'px');
    document.body.appendChild(part);
    setTimeout(() => part.remove(), 900);
  }
}

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

function getTargetPoints(lines) {
  const offscreen = document.createElement('canvas');
  const octx = offscreen.getContext('2d');
  offscreen.width = window.innerWidth;
  offscreen.height = window.innerHeight;

  const fontSize = Math.min(window.innerWidth / 5, 120);
  octx.font = `900 ${fontSize}px sans-serif`;
  octx.textAlign = 'center';
  octx.textBaseline = 'middle';

  const cy = offscreen.height / 2;
  const lineGap = fontSize * 1.1;

  lines.forEach((line, i) => {
    const y = cy - ((lines.length - 1) * lineGap) / 2 + (i * lineGap);
    octx.fillText(line, offscreen.width / 2, y);
  });

  const imageData = octx.getImageData(0, 0, offscreen.width, offscreen.height).data;
  const step = Math.max(9, Math.floor(fontSize / 15));
  const points = [];

  for (let y = 0; y < offscreen.height; y += step) {
    for (let x = 0; x < offscreen.width; x += step) {
      if (imageData[(y * offscreen.width + x) * 4 + 3] > 128) {
        points.push({ x, y });
      }
    }
  }
  // –†–∞–Ω–¥–æ–º–∏–∑–∏—Ä—É–µ–º –ø–æ—Ä—è–¥–æ–∫ —Ç–æ—á–µ–∫, —á—Ç–æ–±—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —ç–º–æ–¥–∑–∏ –±—ã–ª–æ —Å–ª—É—á–∞–π–Ω—ã–º
  return points.sort(() => Math.random() - 0.5);
}

function startFinal() {
  clearInterval(petalTimer);
  ui.style.opacity = '0';
  scoreBox.style.opacity = '0';
  setTimeout(() => { ui.remove(); scoreBox.remove(); }, 500);

  const targetPoints = getTargetPoints(getMessageLines());
  const w = window.innerWidth;
  
  // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∏ –ª–µ–≥–∫–æ–µ —Å–º–µ—â–µ–Ω–∏–µ (jitter)
  const particles = targetPoints.map(p => {
    const jitter = 5; // –°–º–µ—â–µ–Ω–∏–µ –≤ –ø–∏–∫—Å–µ–ª—è—Ö –¥–ª—è –æ—Ä–≥–∞–Ω–∏—á–Ω–æ—Å—Ç–∏
    const sizes = w < 600 ? [13, 15, 17] : [16, 18, 20];
    const size = sizes[Math.floor(Math.random() * sizes.length)];
    const char = TEXT_EMOJI[Math.floor(Math.random() * TEXT_EMOJI.length)];
    
    return {
      x: Math.random() * window.innerWidth,
      y: Math.random() * window.innerHeight,
      tx: p.x + (Math.random() * jitter - jitter/2), 
      ty: p.y + (Math.random() * jitter - jitter/2),
      size: size,
      char: char,
      // –ö–ª—é—á –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (–≥—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Å–∏–º–≤–æ–ª—É –ò —Ä–∞–∑–º–µ—Ä—É)
      sortKey: char + size,
      delay: Math.random() * 600
    };
  });

  // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ Canvas
  particles.sort((a, b) => a.sortKey.localeCompare(b.sortKey));

  const startTime = performance.now();
  const duration = 2500;

  function animate(now) {
    const elapsed = now - startTime;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.globalAlpha = 1;

    let finished = true;
    let currentKey = "";

    for (let i = 0; i < particles.length; i++) {
      const p = particles[i];
      const pElapsed = Math.max(0, elapsed - p.delay);
      const progress = Math.min(pElapsed / (duration - 500), 1);
      const ease = 1 - Math.pow(1 - progress, 3);

      const curX = p.x + (p.tx - p.x) * ease;
      const curY = p.y + (p.ty - p.y) * ease;

      // –û–±–Ω–æ–≤–ª—è–µ–º —à—Ä–∏—Ñ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–ª—é—á–∞ (—Å–∏–º–≤–æ–ª + —Ä–∞–∑–º–µ—Ä)
      if (p.sortKey !== currentKey) {
        ctx.font = `${p.size}px serif`;
        currentKey = p.sortKey;
      }

      ctx.fillText(p.char, curX, curY);
      if (progress < 1) finished = false;
    }

    if (!finished || elapsed < duration) {
      requestAnimationFrame(animate);
    } else {
      // –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—á–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      let lastKey = "";
      for (let p of particles) {
        if (p.sortKey !== lastKey) {
          ctx.font = `${p.size}px serif`;
          lastKey = p.sortKey;
        }
        ctx.fillText(p.char, p.tx, p.ty);
      }
    }
  }
  requestAnimationFrame(animate);
}
</script>
</body>
</html>
